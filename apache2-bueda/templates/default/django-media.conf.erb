<VirtualHost *:<%= @params[:port] %>>
  ServerName <%= @params[:name] %>
  <% if @params[:docroot] %>
  DocumentRoot <%= "#{@params[:parent_dir]}/#{@node[:apache][:head_symlink]}/#{@params[:docroot]}" %>
  <% end %>

  LogLevel info
  ErrorLog syslog:local2
  <% if @params[:behind_load_balancer] %>
  LogFormat "\"%{X-Forwarded-For}i\" %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined-elb
  CustomLog |/usr/local/bin/apache2_syslog.pl combined-elb
  <% else %>
  CustomLog |/usr/local/bin/apache2_syslog.pl combined
  <% end %>
  
  <Directory <%= "#{@params[:parent_dir]}/#{@node[:apache][:head_symlink]}/#{@params[:docroot]}" %>>
    Options FollowSymLinks
    Options -Indexes
    AllowOverride None
    Order allow,deny
    Allow from all
  </Directory>

  Alias /favicon.ico <%= "#{@params[:parent_dir]}/#{@node[:apache][:head_symlink]}/#{@params[:docroot]}" %>/images/favicon.ico
  <Location "/favicon.ico">
    SetHandler None
  </Location>

  Alias /admin <%= "#{@params[:parent_dir]}/#{@node[:apache][:head_symlink]}/#{@params[:admin_media]}" %>
  <Directory <%= "#{@params[:parent_dir]}/#{@node[:apache][:head_symlink]}/#{@params[:admin_media]}" %>>
    Options FollowSymLinks
    Options -Indexes
    AllowOverride None
    Order allow,deny
    Allow from all
  </Directory>

</VirtualHost>
